define("wkview:widget/html_view_newToolsbar/html_reader/js/newtoolsBar/pay.js",function(e,i,o){var a=e("wkcommon:widget/lib/tangram/base/base.js"),s=e("wkcommon:widget/ui/js_core/widget/widget.js").widget,t=e("wkcommon:widget/ui/js_core/util/util.js"),n=e("wkview:widget/html_view/html_reader/js/toolsItem.js").toolsItem,c=e("wkcommon:widget/ui/js_core/login/login.js").login,r=e("wkcommon:widget/lib/fis/data/data.js"),p=e("wkcommon:widget/ui/js_core/log/log.js"),d=e("wkcommon:widget/ui/lib/jquery/jquery.js"),l=e("wkcommon:widget/ui/lib/cookie/cookie.js"),b=e("wkview:widget/down_doc/down_doc_pro/down_doc_pro.js").downDoc,u=s({Options:{position:"centerRight",reader:{}},_init:function(){var e=this,i=r.get("WkInfo").DocInfo,o=r.get("WkInfo").VipInfo,s=r.get("WkInfo").UserInfo,n=((i.payPrice||0)/100).toFixed(2),b=((i.vip_price||0)/100).toFixed(2),u=i.goodsPayStatus,v=((i.confirm_price||n)/100).toFixed(2),_="PCActivity"===u.split("_")[0],g=i.is_only_vip_doc,w=1===+i.org_discount_status,y='<span class="original-price">\uffe5'+n+"&nbsp;</span>",f=Math.round(i.org_discount_price/i.payPrice*10),h=r.get("WkInfo").DocInfo.is_discount_doc;if(w){var m=(i.org_discount_price/100).toFixed(2);y+='<br/><span class="vip-free">'+f+"\u6298\u4ef7:\uffe5"+m+"</span>"}else _?y='<i class="zhe-price-icon"></i><span class="vip-free activity-price">\uffe5'+v+'</span><span class="real-price">\uffe5'+n+"&nbsp;</span>":(y=(i.vip_type>0||i.edu_vip_type>0||i.jiaoyu_vip_type>0)&&i.is_discount_doc?'<i class="zhe-price-icon"></i><span class="vip-free activity-price">\uffe5'+(i.vip_price/100).toFixed(2)+'</span><span class="real-price">\uffe5'+n+"&nbsp;</span>":'<span class="price price-new">\uffe5'+n+"</span>",i.is_only_vip_doc&&(y='<span class="vip-free">\u6587\u5e93VIP\u514d\u8d39\u9605\u8bfb</span>'));var k="";if(void 0!==i.wk2yd&&0!==+i.wk2yd)return g=i.is_only_vip_doc,k=['<div class="reader-tools-btn-wrap-new">','    <a href="http://yuedu.baidu.com/ebook/'+i.wk2yd+'?fr=wenku" class="ui-bz-btn reader-pay'+(g?" reader-pay-disable":"")+'" alog-action="reader.buy.doc">','        <b class="ui-btn-p-10 ui-btn-btc">\u8d2d\u4e70</b>',"    </a>",'    <span class="vip-free-buy'+(g?" only_vip_doc":"")+'">'+y+"</span>","</div>"].join(""),void(e.el=t.createDom(k));k='<div class="reader-tools-btn-wrap-new"><a href="###" class="ui-bz-btn-senior reader-pay'+(g?" reader-pay-disable":"")+'" alog-action="reader.buy.doc"><span class="vip-free-buy'+(g?" only_vip_doc":"")+'">'+y+'</span><b class="ui-btn-p-16 ui-btn-btc">\u8d2d\u4e70\u672c\u6587</b></a><a class="ui-bz-btn pack-pay org-pay-hide ml5" data-toolsbar-log="paybutton"href="###" alog-action="htmltoolbar.buy"><b class="ui-btn-p-16 ui-btn-btc"><i>\u52a0\u5165VIP</i><br>\u672c\u6587\u514d\u8d39\u8d60\u9001</b></a><a class="ui-bz-btn add-vip-discount ml5" style="display:none" href="javascript:;"><b class="ui-btn-p-16"><i>\u52a0\u5165VIP</i><br>8\u6298\u8d2d\u4e70\u672c\u6587</b></a><a class="ui-bz-btn add-vip-chance ml5" style="display:none" href="javascript:;"><b class="ui-btn-p-16"><i>\u52a0\u5165VIP</i><br>\u83b7\u53d6\u66f4\u591a\u7279\u6743</b></a><span class="eight-discount">VIP\u4ef7\u683c\uff1a\uffe5'+b+"</span></div>";var I=1===+o.flag||+i.vip_type>0||1===+i.edu_vip_type||1===+i.jiaoyu_vip_type;if(1===+i.professionalDoc&&(+o.professionalDocDownloadTicket>=1||1===+o.flag||1===+s.smallFlowProfessionalDoc)){var D="";1===+o.flag&&(D='<a style="margin-right:16px" href="/cashier/browse/vipcashier?cashier_code=view_test_yxjxf"><b style="color:#db5b5a" class="iconfont ic-joinvip">&#xe64e;  </b>\u7eed\u8d39VIP\uff0c\u7acb\u8d60\u81f3\u5c115\u6b21\u5171\u4eab\u6587\u6863\u4e0b\u8f7d\u7279\u6743</a>'),k=+I>0&&(+o.professionalDocDownloadTicket>=1||1===+i.isRepeatDown)?'<div class="reader-tools-btn-wrap-new">'+D+'<a href="javascript:;" style="background:#db5b5a" class="ui-bz-btn-senior pro-doc-download"><span class="vip-free-buy">VIP</span><b class="ui-btn-p-16 ui-btn-btc">\u514d\u8d39\u4e0b\u8f7d</b></a></div>':+o.flag>0&&0===+o.professionalDocDownloadTicket&&1!==+i.isRepeatDown?'<div class="reader-tools-btn-wrap-new"><span style="margin-right: 14px;color: #db5b5a;">\u7acb\u4eab\u4e13\u4e1a\u6587\u6863\u4e0b\u8f7d\u7279\u6743</span><a href="/cashier/browse/vippackagecashier?cashier_code=vip_cashier_tips_test_yxj" style="background:#db5b5a" class="ui-bz-btn-senior" alog-action="reader.buy.doc"><span class="vip-free-buy">VIP\u4e13\u4eab</span><b class="ui-btn-p-16 ui-btn-btc">\u4e0b\u8f7d\u7279\u6743\u793c\u5305</b></a></div>':+i.vip_type>0?'<div class="reader-tools-btn-wrap-new"><a class="ui-bz-btn org-pay-hide ml5" data-toolsbar-log="paybutton"href="/cashier/browse/vipcashier?cashier_code=notvip_test_bottom&from_doc='+i.docId+'"alog-action="htmltoolbar.buy"><b class="ui-btn-p-16 ui-btn-btc"><i>\u5347\u7ea7VIP</i><br>\u514d\u8d39\u4e0b\u8f7d\u672c\u6587</b></a></div>':'<div class="reader-tools-btn-wrap-new"><a class="ui-bz-btn org-pay-hide ml5" data-toolsbar-log="paybutton"href="/cashier/browse/vipcashier?cashier_code=notvip_test_bottom&from_doc='+i.docId+'"alog-action="htmltoolbar.buy"><b class="ui-btn-p-16 ui-btn-btc"><i>\u52a0\u5165VIP</i><br>\u514d\u8d39\u4e0b\u8f7d\u672c\u6587</b></a></div>'}if(e.el=t.createDom(k),0===+i.org_discount_status){var j='<div id="org-discount-tip"><span class="close-icon"></span><span class="arrow-icon"></span><span class="tip-text">\u4eca\u5929\u8d2d\u4e70'+i.org_title+"\u6587\u6863\uff0c\u7b2c2\u7bc7\u8d77\u4eab"+f+"\u6298\u4f18\u60e0</span></div>";d(e.el).append(j)}else if(1===+i.org_discount_status){var P='<div id="org-discount-tip" class="now-discount"><span class="close-icon"></span><span class="arrow-icon"></span><span class="tip-text">\u672c\u6b21\u8d2d\u4e70\uff0c\u4eab\u53d7'+f+"\u6298\u54e6\uff01</span></div>";d(e.el).append(P)}l.get("org_discount_pop_close")||d(e.el).find("#org-discount-tip").show(),e.clickEl=a.dom.q("reader-pay",e.el,"a")[0],e.packClickEl=a.dom.q("pack-pay",e.el,"a")[0],e.proDocDownClickEl=a.dom.q("pro-doc-download",e.el,"a")[0],e.bindEvent(),d(e.el).on("click",".add-vip-discount",function(){p.xsend(1,101492),window.location.href="/cashier/browse/dispatch?dqStatCode=31_8_9_73"}),d(e.el).on("click",".add-buy-report",function(){var e=r.get("WkInfo").DocInfo.docId,i=+r.get("WkInfo").PageInfo.isLogin;i?window.location.href="/org/browse/report?fr=btn&cashier_code=buy_report_doc&id="+e:c.verlogin(function(){})}),d(e.el).on("click",".add-vip-chance",function(){d(this).hasClass("add-buy-report")||(p.xsend(1,101492),window.location.href="/cashier/browse/dispatch?dqStatCode=31_8_9_73")}),setTimeout(function(){if(1===+i.hangyebaogao_customized){var e=((+i.confirm_price||0)/100).toFixed(2),t='<span style="color: #888; margin-right: 20px;">\uffe5'+e+"</span>";d(".add-vip-chance").addClass("add-buy-report").find("b").html("\u5f00\u59cb\u5b9a\u5236"),d(".add-vip-chance").show(),d(".reader-pay").hide(),d(".vip-free-buy").html(t)}else i.professionalDoc&&(1===s.smallFlowProfessionalDoc||+o.professionalDocDownloadTicket>=1||1===+o.flag)?(d(".org-pay-hide").css("display","none"),d(".goods-price-wrap").removeClass("mr20")):(n&&5>=n&&(!i.vip_type||0===+i.vip_type)&&0===+i.edu_vip_type&&0===+i.jiaoyu_vip_type&&a.lang.eventCenter.dispatchEvent("pack.button.hide"),i.vip_type&&0!==i.vip_type||0!==i.edu_vip_type||0!==i.jiaoyu_vip_type||(n&&n>5&&b!==n&&1===h&&d(".add-vip-discount").show(),n&&n>5&&b===n&&d(".add-vip-chance").show(),_&&n&&n>5&&(d(".pack-pay").length&&d(".pack-pay").hide(),d(".add-vip-chance").show())))},300)},getFinalPrice:function(){var e=r.get("WkInfo").DocInfo,i=e.payPrice||0,o=e.goodsPayStatus,a=e.confirm_price||i,s="PCActivity"===o.split("_")[0],t=1===+e.org_discount_status,n=i;return t?n=e.org_discount_price:s?n=a:(n=(e.vip_type>0||e.edu_vip_type>0||e.jiaoyu_vip_type>0)&&e.is_discount_doc?e.vip_price:i,e.is_only_vip_doc&&(n=0)),n},bindEvent:function(){var e=this,i=r.get("WkInfo").DocInfo;a.event.on(e.clickEl,"click",function(o){o=o||window.event,a.event.preventDefault(o);var s=a.event.getTarget(o);a.lang.eventCenter.addEventListener("Login.Success",function(e){a.event.stop(e),a.lang.eventCenter.dispatchEvent("ReaderToolsBar.BuyDoc",{target:s})});var t=i.payPrice||0,n=e.getFinalPrice(),d=i.docId,l=d,b=r.get("WkInfo").PageInfo.isLogin;b||p.xsend(1,100351),c.verlogin(function(){p.xsend(1,100351),p.xsend(1,101712),p.xsend(1,101316,{originPrice:t,salePrice:n,docId:d,goodsId:l,type:1}),a.lang.eventCenter.dispatchEvent("ReaderToolsBar.BuyDoc",{target:s})},null,null,null,!1)}),a.event.on(e.packClickEl,"click",function(e){e=e||window.event,a.event.preventDefault(e),p.xsend(1,101492);var o='/cashier/browse/vipwithdoccashier?doc_ids=["'+i.docId+'"]&dqStatCode=31_35_37';window.location.href=o}),a.event.on(e.proDocDownClickEl,"click",function(e){e=e||window.event,a.event.preventDefault(e);var i=new b;i.start()}),d("body").on("click","#org-discount-tip .close-icon",function(){d("#org-discount-tip").hide();var e=new Date;e.setHours(23),e.setMinutes(59),e.setSeconds(59),l.set("org_discount_pop_close","1",{expires:e})})}},{superClass:n});o.exports.pay=u});