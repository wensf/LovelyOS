define("wkview:widget/html_view_newToolsbar/html_reader/js/newtoolsBar/toolsBar.js",function(e,t,o){function i(e,t,o,i){o=o||1;var r=new Date;r.setTime(r.getTime()+24*o*60*60*1e3),i=i&&";path="+i,document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()+i}function r(e){for(var t=e+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){for(var r=o[i];" "===r.charAt(0);)r=r.substring(1);if(-1!==r.indexOf(t))return r.substring(t.length,r.length)}return""}var s=e("wkcommon:widget/lib/tangram/base/base.js"),n=e("wkcommon:widget/ui/js_core/widget/widget.js").widget,a=e("wkcommon:widget/ui/js_core/util/util.js"),l=e("wkview:widget/html_view/html_reader/js/config.js").config,d=e("wkview:widget/html_view/html_reader/js/setting.js").setting,c=e("wkcommon:widget/lib/fis/data/data.js"),f=c.get("WkInfo"),h=s.dom,g=h.q,m=!1,v=!0,p=!1,w=e("wkcommon:widget/ui/js_core/log/log.js"),u=n({Options:{readerContainer:{},reader:{},items:[]},_init:function(){var e=this,t=c.get("isHitVipDocLimited");e.template=['<div class="reader-tools-bar-wrap ugctest tools-bar-small">','<div class="reader-tools-bar">','<div class="reader-tools-bar-center clearfix">','<div class="left"></div>',f.DocInfo.isPaymentDoc&&f.DocInfo.ispaied&&0===~~f.DocInfo.isPayDocAndCommented&&!r("closeComment")?'<span id="add-comment-tips" class="add-comment-tips"><span class="comment-tips-close"></span></span>':'<span id="share-tips" class="fenxiang"><span class="close fenxiang"></span></span>','<div class="center"><div class="centerLeft"></div><div class="centerRight"></div></div>','<div class="right"></div>',"</div>","</div>","</div>"].join(""),e.wrapEl=a.createDom(e.template),e.bodyEl=s.dom.query(l.bodySelector)[0],e.asideEl=s.dom.query(l.aside)[0],e.asideWidth=e.asideEl.offsetWidth+34,e.el=g("reader-tools-bar",e.wrapEl,"div")[0],e.left=g("left",e.el,"div")[0],e.right=g("right",e.el,"div")[0],e.center=g("center",e.el,"div")[0],e.centerRight=g("centerRight",e.el,"div")[0],e.close=h.q("fenxiang",e.el,"span")[1],e.commentClose=h.q("comment-tips-close",e.el,"span")[0],e.toolsDocBottom=!1,e.items.length&&e._initItem(),f.DocInfo.isApi||document.body.appendChild(e.wrapEl),e.fire("onload"),e.bindEvent(),t&&$(".reader-tools-bar").find(".right").addClass("right-vip-auto");var o=1===+f.VipInfo.flag||+f.DocInfo.vip_type>=1||1===+f.DocInfo.edu_vip_type||1===+f.DocInfo.jiaoyu_vip_type;1===+f.DocInfo.professionalDoc&&+o>0&&1===+f.UserInfo.smallFlowProfessionalDoc?$(".reader-tools-bar").find(".right").eq(0).width("0"):o&&1===+f.UserInfo.smallFlowProfessionalDoc&&$(".reader-tools-bar").find(".right").eq(0).width("238")},_initItem:function(){var e=0,t=this,o=t.items,i=o.length;for(t.list=[],i;i>e;e++)t.addItem(o[e])},bindEvent:function(){var e=this,t=$(".reader-tools-bar").find(".reader-back2top-wrap");e.on("itemChange",function(t,o){var i=o.target,r=0,s=e.list,n=s.length;for(n;n>r;r++)i!==s[r]&&(s[r].status="disabled")}),$(window).on("scroll",function(){var e=$(window).scrollTop();200>e?t.css("display","none"):("none"===t.css("display")&&w.xsend(1,101018,{index:1001}),t.css("display","block"))}),s.event.on(e.close,"click",function(){$(this).parent().hide()}),s.event.on(e.commentClose,"click",function(){i("closeComment","1"),$(this).parent().hide()}),s.event.on(e.wrapEl,"mouseleave",function(){e.resizeRight()}),s.event.on(e.el,"click",function(e){var t=s.event.getTarget(e);itemAttr=s.dom.getAttr(t,"data-toolsBar-log"),itemAttr&&s.lang.eventCenter.dispatchEvent("ReaderToolsBar.itemClick",{name:itemAttr,el:t,setting:d})}),s.lang.eventCenter.addEventListener("InFullScreen.after",s.fn.bind(e.resizeFullScreen,e)),s.lang.eventCenter.addEventListener("OutFullScreen.after",s.fn.bind(e.resize,e)),s.lang.eventCenter.addEventListener("Reader.fullScreenResize",s.fn.bind(e.resizeFullScreen,e)),s.lang.eventCenter.addEventListener("xreaderResizeRight",s.fn.bind(e.resizeRight,e)),s.event.on(window,"scroll",function(){s.lang.eventCenter.dispatchEvent("window.scroll")}),s.lang.eventCenter.addEventListener("window.scroll",s.fn.bind(e.resizeLocation,e))},addItem:function(e){if(s.lang.isFunction(e)){var t=this,o=new e({readerContainer:t.readerContainer,toolsBar:t,reader:t.reader,status:"disabled"}),i=o.position,r=g(i,t.el,"div")[0];o.el&&r.appendChild(o.el),t.list.push(o)}},resizeFullScreen:function(){var e=this;e.toolsDocBottom&&($(".reader-tools-bar-wrap").appendTo($("body")),$(".reader-tools-bar-wrap").css("position","fixed")),e.el.style.width="100%",e.el.offsetWidth<860&&(e.el.style.width="860px"),s.lang.eventCenter.dispatchEvent("ToolsBar.resize",{isMax:!0}),e.toolsDocBottom=!1,e.resizeCenter(),e.resizeRight()},resizeCenter:function(){var e=this,t=e.center,o=e.el.offsetWidth-e.asideWidth;e.right.style.display=900>o?"none":"",t.style.width=o+"px"},resizeRight:function(){var e=this,t=$(".reader-tools-bar").find(".right");centerRightWidth=e.centerRight.offsetWidth+20+"px",width=e.el.offsetWidth-e.asideWidth,900>width||t.css("right",centerRightWidth)},resize:function(){var e=this;v?(s.lang.isFunction(p)||(p=a.debounce(e._resizeFunc,300,e)),p()):(m=!0,e.resizeCenter()),e.toolsDocBottom?$(".reader-tools-bar").css("margin","0"):$(".reader-tools-bar").css("margin","auto")},resizeLocation:function(){var e=this,t=$(".doc-reader").height(),o=$(".doc-reader").offset().top,i=+$(window).scrollTop(),r=+$(window).height(),s=+$(".reader-tools-bar-wrap").height(),n=r-(t+o-i);return $(".reader-tools-bar-wrap").find(".reader-fullScreen").hasClass("isFullScreen")?void 0:$(window).width()<1310?void(e.toolsDocBottom&&($(".reader-tools-bar-wrap").css("position","fixed"),$(".reader-tools-bar").css("margin","auto"),e.toolsDocBottom=!1)):void($(".reader-container").width()<960||(n>s&&!e.toolsDocBottom?($("#doc-main").find(".ft").before($(".reader-tools-bar-wrap")),$(".reader-tools-bar-wrap").css("position","relative"),$(".reader-tools-bar").css("margin","0"),e.toolsDocBottom=!0):s>n&&e.toolsDocBottom?($(".reader-tools-bar-wrap").css("position","fixed"),$(".reader-tools-bar").css("margin","auto"),e.toolsDocBottom=!1):e.toolsDocBottom?$(".reader-tools-bar").css("margin","0"):$(".reader-tools-bar").css("margin","auto")))},_resizeFunc:function(e){var t=this;if(e=e||{},!d.isFullScreen){if(!v)return void(m=!0);{var o=(s.page.getViewWidth(),e.bodyElWidth||t.bodyEl.offsetWidth);t.asideEl.offsetWidth}970>o-230?($(".reader-tools-bar-wrap").addClass("tools-bar-smaller"),$(".reader-tools-bar").css("width","1124px"),s.lang.eventCenter.dispatchEvent("ToolsBar.resize",{isMax:!0})):$(window).width()>1310&&($(".reader-tools-bar-wrap").removeClass("tools-bar-smaller"),$(".reader-tools-bar").css("width","1200px"),s.lang.eventCenter.dispatchEvent("ToolsBar.resize",{isMax:!0})),t.el.style.overflow="hidden",t.resizeCenter(),t.resizeRight(),t.el.style.overflow="",m=!1}}});o.exports.toolsBar=u});