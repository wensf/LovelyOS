require.async(["wkcommon:widget/lib/tangram/base/base.js","wkcommon:widget/lib/fis/data/data.js","wkview:widget/ui/view/down_doc/down_doc.js","wkcommon:widget/ui/js_core/login/login.js","wkcommon:widget/ui/js_core/log/log.js","wkcommon:widget/ui/lib/jquery/jquery.js","wkcommon:widget/ui/lib/store/store.js","wkview:widget/doc_download_main/doc_download_main.js","wkview:widget/html_view/html_reader/js/setting.js"],function(){var e,o,i=arguments,t=0,a=i[t++],n=i[t++],s=i[t++],c=i[t++],d=i[t++],r=i[t++],l=i[t++],f=i[t++],p=i[t++];a.dom.ready(function(){var i=n;r(window).bind("beforeunload",function(){var e=p.setting.currentPage||1,o={docId:i.get("WkInfo").DocInfo.docId,totalPageNum:i.get("WkInfo").DocInfo.totalPageNum,docFlag:i.get("WkInfo").DocInfo.flag,currentPage:e,duration:(new Date).getTime()-PLAYER_LOAD_START,docType:i.get("WkInfo").DocInfo.docType,player:i.get("WkInfo").DocInfo.player};d.xsend(1,100038,o);for(var t=(new Date).getTime();(new Date).getTime()-t<200;);}),r(".nav-wrap").delegate("a","mousedown",function(){d.xsend(1,100023,{href:encodeURIComponent(r(this).attr("href"))})}),r.ajax({url:"/customer/interface/getuserdownloadticket",type:"get",cache:!1,success:function(o){if(0===o.status.code){var i=0,t=0,a=+o.data.isvip;o.data.edu_vip_data&&(i=+o.data.edu_vip_data.is_edu_vip),o.data.jiaoyu_vip_data&&(t=+o.data.jiaoyu_vip_data.is_jiaoyu_vip),e=a||i||t}}}),a.ajax.get("/user/interface/getuserinfo?t="+Math.round((new Date).getTime()/6e3),function(e,t){var n=t?a.json.parse(t):t;if(n&&0===n.status.code){var s,c,d="string"==typeof n?"":n.data.vipinfo,l="string"==typeof n?"":n.data.edu_vip_info,f="string"==typeof n?"":n.data.jiaoyu_vip_info,p=0,g=0;setTimeout(function(){var e=a.dom.g("tip-notice-new"),t=a.dom.g("vip-msg");p=+l.is_vip||0,g=+f.is_vip||0,s=d.type||p||g||0;{var n=(i.get("WkInfo").VipInfo,i.get("WkInfo").DocInfo),u=i.get("WkInfo").UserInfo;1===+n.professionalDoc&&(+d.professionalDocDownloadTicket>=1||1===+d.flag||1===+u.smallFlowProfessionalDoc)}if(s?(a.dom.removeClass(t,"vip-msg-hide"),a.dom.addClass(e,"doc-tag"),r("#tip-notice-new").remove(),c=a.dom.g("tip-notice")):(r("#tip-notice-new").css("display","inline-block"),a.lang.eventCenter.dispatchEvent("xreaderResizeRight")),c&&s&&!o&&1!==+n.professionalDoc){if(1===+u.smallFlowProfessionalDoc)var v="\u7eed\u8d39VIP,\u7acb\u8d60\u81f3\u5c115\u6b21\u5171\u4eab\u6587\u6863\u4e0b\u8f7d\u7279\u6743";else var v='\u7eed\u8d39VIP,\u7acb<span class="five-times">\u8d605\u6b21</span>\u4e0b\u8f7d\u7279\u6743\u8d77';d.type||(r("#vip-msg .ic").addClass("ic-jiaoyu").removeClass("ic-joinvip"),g||(v='\u5347\u7ea7\u5168\u65b0<span class="jiaoyuVip-tip">\u767e\u5ea6\u6559\u80b2VIP</span>\uff0c\u66f4\u591a\u8d44\u6e90\u66f4\u591a\u7279\u6743')),c.innerHTML=v,a.dom.setAttr(c,"href","//yuedu.baidu.com/trade/browse/cashier?type=2&fr=downPop&pos=viewPage_down&ad_logo_type=1&click_type=11011002");var w=i.get("WkInfo").DocInfo.docId,_="/cashier/browse/dispatch?doc_id="+w+"&dqStatCode=31_8_9_11";a.dom.setAttr(c,"href",_)}},1e3)}else r("#tip-notice-new").css("display","inline-block"),a.lang.eventCenter.dispatchEvent("xreaderResizeRight")});var t=n.get("WkInfo"),l=t.DocInfo,g=c.login,u=t&&t.DocInfo&&t.DocInfo.docId||"";if(d.xsend(1,100604),a.cookie.get("BAIDU_DOC_NACT"+u)){if(!a.g("login")){var v=a.cookie.get("BAIDU_DOC_NACT"+u);switch(v){case"download":if(t.UserInfo.isLimit)g.notifyToVerificationMail();else{var w=s.downDocCreate();w.start()}break;case"upload":location.href="/new?fr=login";break;case"cashier":l.vip_type&&0!==l.vip_type||0!==l.edu_vip_type||0!==l.jiaoyu_vip_type||(location.href="/cashier/browse/dispatch?doc_id="+t.DocInfo.docId+"&dqStatCode=31_8_171_174");break;case"addToAlbum":}}a.cookie.remove("BAIDU_DOC_NACT"+u)}var _=location.search;_.indexOf("isbtn")>-1&&f.goSpecialDownload(t),d.send("view","viewload",{cid1:l.cid1,cid2:l.cid2,cid3:l.cid3,cid4:l.cid4,doctype:l.docType,copyright:t.PageInfo.copyright,relatedoc:l.relateDoc,otherlikedoc:l.otherLikeDoc,relatealblum:l.relateAlblum,sameseriesdoc:l.sameSeriesDoc,flag:l.flag,ply:l.readerType,action:"pc_pv"})}),a.dom.ready(function(){var i=n.get("WkInfo"),t=i.PageInfo.isLogin,s=+i.DocInfo.hangyebaogao_customized,c=i.DocInfo.org_engName;if(1===+s&&(d.xsend(1,100764),"chinairr"===c?d.xsend(1,100793):"ibaogao"===c&&d.xsend(1,100794)),t){var f=a.cookie.get("wk_user_view");f&&a.cookie.set("wk_user_view","",{path:"/",expires:36e5});var p=(new Date).getTime(),g=i.DocInfo.title,u=i.DocInfo.docId,v=i.DocInfo.docType,w=v+":"+u+":"+g+":"+p,_=l.get("wk_user_view")+"",m=l.get("wk_user_view");if(m=m?m.split("###"):[],-1!==_.indexOf(u)||-1!==_.indexOf("undefined"))for(var h=0;h<m.length;h++)if(-1!==(m[h]+"").indexOf(u)||-1!==(m[h]+"").indexOf("undefined")){m.splice(h,1);break}m.push(w),m.length>12&&m.shift(),l.set("wk_user_view",m.join("###"));var y=l.get("wk_user_view_uploaded");if(!y){l.set("wk_user_view_uploaded",1);var I={};for(h=0;h<m.length;h++){var D=m[h].split(":");4===D.length&&(I[D[1]]=D[3].substring(0,10))}r.ajax({url:"/user/interface/jiaoyusession",type:"GET",data:{source:"pc",action:"set",mark:JSON.stringify(I)},timeout:5e3,error:function(){console.log("\u8bf7\u6c42\u51fa\u9519(\u8bf7\u68c0\u67e5\u76f8\u5173\u5ea6\u7f51\u7edc\u72b6\u51b5.)")}})}u=i.DocInfo.docId,p=Math.floor((new Date).getTime()/1e3),r.ajax({url:"/user/interface/jiaoyusession",type:"GET",data:{source:"pc",action:"set",mark:'{"'+u+'":'+p+"}"},timeout:5e3,error:function(){console.log("\u8bf7\u6c42\u51fa\u9519(\u8bf7\u68c0\u67e5\u76f8\u5173\u5ea6\u7f51\u7edc\u72b6\u51b5.)")}})}r.ajax({type:"get",async:!0,cache:!1,url:"/user/interface/getvipfreedoc?doc_id="+i.DocInfo.docId,success:function(s){var c=!1,d=r("#tip-notice-new"),l=r(".new-ico-wkmember-free-doc"),f=i.DocInfo.docTicket||0,p=+i.DocInfo.isPaymentDoc||0,g=+i.DocInfo.ispaied||0,u=+i.DocInfo.hangyebaogao_customized||0;s&&0===s.status.code&&(s.data.is_vip_free_doc&&(c=!0,o=!0,c&&(l.show(),r(window).scroll(function(){var e=l.parent(),o=0===r("body").scrollTop()&&r("html").scrollTop()?"html":"body";l.css(r(o).scrollTop()>280&&r(o).scrollTop()<e.height()+50?{position:"fixed",left:e.offset().left-3,top:80}:{position:"absolute",top:20,left:-3})}),r(window).resize(function(){var e=l.parent(),o=0===r("body").scrollTop()&&r("html").scrollTop()?"html":"body";l.css(r(o).scrollTop()>280&&r(o).scrollTop()<e.height()+50?{position:"fixed",left:e.offset().left-3,top:80}:{position:"absolute",top:20,left:-3})}),setTimeout(function(){if(d=r("#tip-notice-new"),d&&0===r("#ppt-wrap").length){if(d.addClass("btn-wkvip"),d.html("<div><p>VIP\u4e13\u4eab</p>\u514d\u8d39\u4e0b\u8f7d</div>"),d.addClass("vip-enjoy"),t){var e=+n.get("isDialogCashier");if(0!==+i.DocInfo.vip_type&&i.DocInfo.vip_type||1!==e){var o="/cashier/browse/dispatch?dqStatCode=31_8_171_174&from_doc="+i.DocInfo.docId;d.attr("href",o)}else;}d.css({visibility:"inherit"});var a=r("#tip-notice"),s=r("#vip-msg");a.html(""),a.addClass("a-new"),a.attr("href","/usera/browse/newvipfreedoczone"),a.addClass("log-xsend"),s.removeClass("vip-msg-hide"),r("#vip-msg .ic").remove(),a.attr("data-logxsend","[1, 100833]")}},800)),n.set("VipFreeDoc",c)),s.data.is_vip_free_doc||setTimeout(function(){e||(d=r("#tip-notice-new"),f||(d.html("<i>\u52a0\u5165VIP</i><br>\u83b7\u53d6\u66f4\u591a\u7279\u6743"),d.css("display","inline-block"),a.lang.eventCenter.dispatchEvent("xreaderResizeRight")),d.css({visibility:"inherit"}))},1e3),g&&u&&p&&setTimeout(function(){var e=r("#tip-notice-new");e.hide()},1200))}})})});