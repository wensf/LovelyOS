define("wkview:widget/ui/reader/view/doc/render.js",function(t,e,r){var i=t("wkcommon:widget/lib/tangram/base/base.js"),o=t("wkcommon:widget/ui/js_core/util/util.js"),a="reader-word-s",n=1,p=10,s="reader-word-layer",h="",l=null,u="reader-render-style",c=function(){return i.browser.firefox?"-moz-":i.browser.chrome||i.browser.safari?"-webkit-":i.browser.ie&&i.browser.ie>8?"-ms-":""}(),f=function(){return i.browser.ie&&i.browser.ie<9?"ie":"other"}(),x=function(t,e,r,i,o,a){var n,p,s,h,l=[],u=2,c=e.v,x=a.picUrl,y=a.fontMapping,g={word:d,pic:b[f]},w={pic:'<div class="reader-pic-layer" style="z-index:__NUM__"><div class="ie-fix">',word:'<div class="reader-txt-layer" style="z-index:__NUM__"><div class="ie-fix">'},v="</div></div>",m=0,_=0;t.sort(function(t,e){return t.p.z-e.p.z});for(var M=-1,F=t.length;++M<F;)n=t[M],"pic"===n.t&&(m=Math.max(m,n.c.ih+n.c.iy+5),_=Math.max(_,n.c.iw));for(var M=-1,F=t.length;++M<F;)n=t[M],s=n.t,!p&&(p=h=s),p===s?l.push(g[n.t](n,i,r,y,e,c,x,o,m,_)):(l.push(v),l.push(w[s].replace(/__NUM__/,u++)),l.push(g[n.t](n,i,r,y,e,c,x,o,m,_)),p=s);return w[h].replace(/__NUM__/,1)+l.join("")+v},d=function(t,e,r,o,a,h){var l,u,c=i.string.encodeHTML,x=t.p,d=t.ps,b=t.s,_=y,M=g,F=['<b style="font-family:simsun;">&nbsp</b>',"\n"],j=i.lang.isNumber,z=i.lang.isObject,O=p,P=n,N=w,k=m,T=z(d),U=x.w,X=x.h,S=x.y,q=x.x,I=x.z,A=new RegExp("([\\s\\t\\xa0\\u3000])|([\\u3000\\xa0\\s\\t]$)","g");return T&&(j(d._opacity)&&1===d._opacity||j(d._alpha)&&0===d._alpha)?"":(l=~~(U*O*P),u=~~(X*O*P),["<p ",'class="'+s+M(t.r,e)+'" ','style="',"width:"+l+"px;","height:"+u+"px;","line-height:"+u+"px;","top:"+~~(S*O*P)+"px;","left:"+~~(q*O*P)+"px;","z-index:"+I+";",_(b,r,o,h),T&&j(d._rotate)&&N[f](d._rotate,U,X,q,S,O,P)||"",T&&j(d._opacity)&&k[f]()||"",T&&j(d._alpha)&&k[f](d._alpha)||"",T&&j(d._scaleX)&&v[f](d._scaleX,l,u)||"",i.lang.isString(t.c)&&1===t.c.length&&t.c.match(A)&&"font-family:simsun;",'">',c(t.c).replace(A,"&nbsp"),T&&j(d._enter)&&F[d._enter]||"","</p>"].join(""))},y=function(t,e,r,i){var o,a=[],s={"font-size":1},h=p,l=n,u={"font-family":function(t,o){var n=e?e[o]||o:o;a.push("other"===f||+i>5?"font-family:'"+n+"','"+o+"','"+(r.hasOwnProperty(n)&&r[n]||n)+"';":"font-family:'"+o+"','"+n+"','"+(r.hasOwnProperty(n)&&r[n]||n)+"';")},bold:function(t,e){"false"!==e&&a.push("font-weight:600;")},"letter-spacing":function(t,e){a.push("letter-spacing:"+e*p+"px;")}};for(o in t)u[o]?u[o](o,t[o]):a.push(o+":"+(s[o]?~~(t[o]*h*l)+"px":t[o])+";");return a.join("")},g=function(t){var e=" "+h;return i.lang.isArray(t)&&t.length?e+t.join(e):""},w={ie:function(t,e,r,i,o,a,n){{var p=Math.PI/180,s=t*p,h=Math.sin(s);Math.cos(s)}return["filter:progid:DXImageTransform.Microsoft.Matrix(M11='0', M12='"+-h+"', M21='"+h+"', M22='0', sizingMethod='auto expand');","width:"+r*a*n+"px;","height:"+(e+7)*a*n+"px;"].join("")},other:function(t,e,r,i,o,a,n){var p=[],s=a*n,h={90:function(){p.push("left:"+~~(i+(e-r)/2)*s+"px;"),p.push("top:"+~~(o-(r-e)/2)*s+"px;"),p.push("text-align: right;"),p.push("height:"+~~(r+7)*s+"px;")},180:function(){p.push("left:"+~~(i-e)*s+"px;"),p.push("top:"+~~(o-r)*s+"px;")},270:function(){p.push("left:"+~~(i+(r-e)/2)*s+"px;"),p.push("top:"+~~(o-(e-r)/2)*s+"px;")}};return h[t](),c+"transform:rotate("+t+"deg);"+p.join("")}},v={ie:function(t,e,r){return"filter: progid:DXImageTransform.Microsoft.Matrix(M11="+t+",M12=0,M21=0,M22=1,SizingMethod='auto expand');width:"+(e+Math.floor(e/2))+"px;height"+(r+Math.floor(r/2))+"px;"},other:function(t,e,r){return c+"transform: scaleX("+t+");"+c+"transform-origin:left top;width:"+(e+Math.floor(e/2))+"px;height:"+(r+Math.floor(r/2))+"px;"}},m={ie:function(t){return t=t||0,t=100*t,"filter: alpha(opacity="+t+");"},other:function(t){return t=t||0,"opacity:"+t+";"}},b={ie:function(t,e,r,i,o,a,p,s){var h=t.p,l=t.c,u=h.w,c=h.h,f=h.y,x=h.x,d=h.z,y=n,g=_(h,l,o);return+a>5&&h.hasOwnProperty("opacity")&&0===h.opacity?"":['<div style="',"width:"+~~(u*y)+"px;","height:"+~~(c*y)+"px;","top:"+~~(f*y)+"px;","left:"+~~(x*y)+"px;","z-index:"+d+";",'position:absolute;">','<v:image type="tile" stroked="false" src="'+p({doc_id:s,version:a,pn:e})+'"',g.attr(),' style="'+g.style()+'"></v:image></div>'].join("")},other:function(t,e,r,i,o,a,n,p,s,h){var l=t.p,u=t.c,c=(l.w,l.h,l.y,l.x,l.z,[]);return+a>5&&l.hasOwnProperty("opacity")&&0===l.opacity?"":l.hasOwnProperty("x1")||0!==l.rotate&&1!==l.opacity?(c.push("background-image: url("+n({doc_id:p,version:a,pn:e})+");"),c.push("background-position:"+-u.ix+"px "+-u.iy+"px;"),c.push("width:"+u.iw+"px;"),c.push("height:"+u.ih+"px;"),c.push(j(l,u)),'<div class="reader-pic-item" style="'+c.join("")+'position:absolute;overflow:hidden;"></div>'):(c.push("width:"+u.iw+"px;"),c.push("height:"+u.ih+"px;"),c.push(j(l,u)),'<p class="reader-pic-item" style="'+c.join("")+'position:absolute;overflow:hidden;"><img width="'+h+'" height="'+s+'" style="position:absolute;top:-'+u.iy+"px;left:-"+u.ix+"px;clip:rect("+u.iy+"px,"+(h-u.ix)+"px, "+s+"px, "+u.ix+'px);" src="'+n({doc_id:p,version:a,pn:e})+'" alt=""></p>')}},_=function(t,e,r){if(!t)return!1;var o=parseFloat(e.iw),a=parseFloat(e.ih),p=parseFloat(r.iw),s=parseFloat(r.ih),h=(parseFloat(e.ix)/p).toFixed(4),l=(parseFloat(e.iy)/s).toFixed(4),u=(1-o/p-h).toFixed(4),c=(1-a/s-l).toFixed(4),x=i.lang.isNumber;return{style:function(){var e,r=[];return x(t.opacity)&&t.opacity<1&&.01!==t.opacity&&0!==t.opacity&&r.push("filter: alpha(opacity="+100*t.opacity+");"),r.push("width:"+t.w*n+"px;"),r.push("height:"+t.h*n+"px;"),t.w==o&&t.h==a||!t.hasOwnProperty("x1")||(e=M(t.x0,t.y0,t.x1,t.y1,t.x2,t.y2),r.push("width:"+e[0]*n+"px;"),r.push("height:"+e[1]*n+"px;")),t.hasOwnProperty("x1")&&r.push(F[f](Math.abs(t.rotate)>.01?t.rotate:0,t.x1,t.x2,t.y0,t.y1)),r.join("")},attr:function(){var t=[];return t.push('cropleft="'+h+'"'),t.push('croptop="'+l+'"'),t.push('cropright="'+u+'"'),t.push('cropbottom="'+c+'"')," "+t.join(" ")}}},M=function(t,e,r,i,o,a){var n=Math,p=n.sqrt(n.pow(n.abs(t-r),2)+n.pow(n.abs(e-i),2)).toFixed(4),s=n.sqrt(n.pow(n.abs(r-o),2)+n.pow(n.abs(i-a),2)).toFixed(4);return[s,p]},F={ie:function(t,e,r,i,o){var a=!1,n=!1,p=[],s=!1;return o>i&&(a=!0),e>r&&(n=!0),a?(p.push("flip: y;"),s=!0,n&&p.push("flip:"+(s?"y x":"x")+";")):t&&p.push("rotation:"+t+";"),p.join("")},other:function(t,e,r,i,o,a){var n=!1,p=!1;return o>i&&(n=!0),e>r&&(p=!0),n&&p?a+=" Matrix(-1,0,0,-1,0,0)":n?a+=" Matrix(1,0,0,-1,0,0)":p?a+=" Matrix(-1,0,0,1,0,0)":t&&(a+=" rotate("+t+"deg)"),a+";"}},j=function(t,e){if(!t)return!1;var r,o,a,p,s=e.iw,h=e.ih,l=n,u=t.x*l+"px",f=t.y*l+"px",x=[],d="",y={},g=i.lang.isNumber,w={opacity:1,rotate:1,z:1};for(p in t)y[p]=!w[p]&&g(t[p])?t[p]*l:t[p];if(y.w!=s||y.h!=h){y.hasOwnProperty("x1")&&(a=M(y.x0,y.y0,y.x1,y.y1,y.x2,y.y2)),r=a?parseFloat(parseFloat(a[0])/s).toFixed(2):parseFloat(y.w/s).toFixed(2),o=a?parseFloat(parseFloat(a[1])/h).toFixed(2):parseFloat(y.h/h).toFixed(2);var v=s*(r-1),m=h*(o-1);d=c+"transform: scale("+r+","+o+")",y.hasOwnProperty("x1")?(f=(y.y1+y.y3)/2-parseFloat(h)/2+"px",u=(y.x1+y.x3)/2-parseFloat(s)/2+"px"):(f=y.y+m/2+"px",u=y.x+v/2+"px")}return x.push("z-index:"+y.z+";"),x.push("left:"+u+";"),x.push("top:"+f+";"),x.push("opacity:"+(y.opacity||1)+";"),x.push(y.hasOwnProperty("x1")?F.other(Math.abs(y.rotate)>.01?y.rotate:0,y.x1,y.x2,y.y0,y.y1,d):d+";"),x.join("")},z=function(t,e,r,o){var a,n,p,s=[],l=t.length,u=i.string.trim,c=r.fontMapping,f=r._fontList;for(n=0;l>n;n++)a=t[n],a.s&&(p=u(O(a.s,e,c,r)),p&&s.push("."+h+a.c.join(",."+h)+"{ "+p+"}"),a.s["font-family"]&&(f[a.s["font-family"]]=h+a.c[0]));return s.push("#pageNo-"+o+" .reader-parent{visibility:visible;}"),s.join(" ")},O=function(t,e,r,i){var o,a=[],s=p,h=n,l={"font-size":function(t,e){a.push("font-size:"+~~(e*s*h)+"px;")},"letter-spacing":function(t,e){a.push("letter-spacing:"+e*p+"px;")},bold:function(t,e){"false"!==e&&a.push("font-weight:600;")},"font-family":function(t,o){var n=e?e[o]||o:o;a.push("other"===f||+i.readerVersion>5?"font-family:'"+n+"','"+o+"','"+(r.hasOwnProperty(n)&&r[n]||n)+"';":"font-family:'"+o+"','"+n+"','"+(r.hasOwnProperty(n)&&r[n]||n)+"';")}};for(o in t)l[o]?l[o](o,t[o]):a.push(o+":"+t[o]+";");return a.join("")},P=function(t,e,r){var p=t.page;if(h=a+e+"-",!i.lang.isArray(t.body))return"";p&&(n=parseFloat(parseFloat(r.pw)/parseFloat(p.pw)).toFixed(4));{var s=o.cssStringManager(u),c=z(t.style,t.font,r,e);r.doc_id_update}return clearTimeout(l),s.register(e,c),s.render(),x(t.body,t.page,t.font,e,r.doc_id_update,r)};r.exports.compile=P;var N=function(t,e,r,i,o){var a="",o=o?o:.93;return null===t?"":(a="ie"===f?"zoom:"+o+";":c+"transform:scale("+o+");"+c+"transform-origin:left top;",['<div class="reader-parent-'+e+' reader-parent" style="position:relative;top:0;left:0;'+a+'">','<div class="reader-wrap'+e+'" style="position:absolute;top:0;left:0;width:100%;height:100%;">','<div class="reader-main-'+e+'" style="position:relative;top:0;left:0;width:100%;height:100%;">',t,"</div>","</div>","</div>"].join(""))};r.exports.render=N;var k=function(t,e){if(t=i.dom.q("reader-parent",t),!t||!i.lang.isElement(t[0]))return!1;if(t=t[0],"ie"===f)i.dom.setStyle(t,"zoom",e);else{var r=c+"transform:scale("+e+");"+c+"transform-origin:0 0;";t.style.cssText+=r}};r.exports.zoom=k});